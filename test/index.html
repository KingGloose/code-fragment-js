<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>屏幕捕捉示例</title>
  </head>
  <body>
    <h2>屏幕捕捉示例</h2>
    <button id="startCapture">开始捕捉屏幕</button>
    <button id="stopCapture" disabled>停止捕捉</button>
    <video id="screenVideo" autoplay playsinline></video>

    <script>
      const startButton = document.getElementById("startCapture");
      const stopButton = document.getElementById("stopCapture");
      const videoElement = document.getElementById("screenVideo");
      let mediaStream = null;

      // 开始屏幕捕捉
      startButton.addEventListener("click", async () => {
        try {
          mediaStream = await navigator.mediaDevices.getDisplayMedia({
            video: { cursor: "always" }, // 捕捉鼠标指针
            audio: false, // 是否捕捉音频
          });

          videoElement.srcObject = mediaStream;
          startButton.disabled = true;
          stopButton.disabled = false;

          // 监听流的结束事件
          mediaStream.getVideoTracks()[0].addEventListener("ended", () => {
            stopCapture();
          });
        } catch (err) {
          console.error("屏幕捕捉失败:", err);
        }
      });

      // 停止屏幕捕捉
      stopButton.addEventListener("click", stopCapture);

      function stopCapture() {
        if (mediaStream) {
          mediaStream.getTracks().forEach((track) => track.stop());
          videoElement.srcObject = null;
        }
        startButton.disabled = false;
        stopButton.disabled = true;
      }
    </script>
  </body>
</html>
